# ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠ LINE Messaging ‡∏û‡∏£‡πâ‡∏≠‡∏° Gemini AI

## üöÄ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°

‡∏£‡∏∞‡∏ö‡∏ö LINE Messaging ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡πÉ‡∏´‡πâ:
- ‚úÖ ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Supabase
- ‚úÖ ‡πÉ‡∏ä‡πâ Gemini AI ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡πà‡∏ô‡∏¢‡∏≤‡πÇ‡∏î‡∏£‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£
- ‚úÖ ‡∏°‡∏µ Rich Menu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÅ‡∏•‡∏∞ Provider
- ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÅ‡∏ö‡∏ö real-time

## üìã ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö

### 1. ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å

| ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á | ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á |
|--------|----------|----------|
| `‡∏à‡∏≠‡∏á‡πÇ‡∏î‡∏£‡∏ô`, `‡∏û‡πà‡∏ô‡∏¢‡∏≤` | ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏£‡∏ô | "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡πÇ‡∏î‡∏£‡∏ô" |
| `‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£`, `‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£` | ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πà‡∏≤ | "‡∏≠‡∏¢‡∏≤‡∏Å‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£" |
| `‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥`, `‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á` | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | "‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á" |
| `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞`, `‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö` | ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î | "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞" |
| `‡∏£‡∏≤‡∏Ñ‡∏≤`, `price` | ‡∏î‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• | "‡∏î‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤" |
| `‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠`, `help` | ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏¥‡∏ò‡∏µ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô | "‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠" |

### 2. Gemini AI

‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÉ‡∏ä‡πâ Gemini AI ‡∏ï‡∏≠‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:

**‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°:**
- "‡πÇ‡∏î‡∏£‡∏ô‡∏û‡πà‡∏ô‡∏¢‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏£"
- "‡∏Å‡∏≤‡∏£‡∏û‡πà‡∏ô‡∏¢‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡πÇ‡∏û‡∏î‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏ä‡πà‡∏ß‡∏á‡πÑ‡∏´‡∏ô"
- "‡∏°‡∏µ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ñ‡∏ô‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πà‡∏≤‡πÑ‡∏´‡∏°"
- "‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏á"
- "‡∏ï‡πâ‡∏≠‡∏á‡∏à‡∏≠‡∏á‡∏•‡πà‡∏ß‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏µ‡πà‡∏ß‡∏±‡∏ô"

## ü§ñ ‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á Gemini AI

### Configuration
```typescript
// lib/gemini/ai-helper.ts
const GEMINI_API_KEY = "AIzaSyDcMzY_EyWAOMK1o7DGek37b8DjKKAdpDM"
```

### System Instruction
AI ‡∏à‡∏∞‡∏ï‡∏≠‡∏ö‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:
- ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ: ‡∏û‡πà‡∏ô‡∏¢‡∏≤‡πÇ‡∏î‡∏£‡∏ô, ‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£
- ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡∏≤‡∏°‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä‡πÅ‡∏•‡∏∞‡∏™‡∏≤‡∏£‡∏û‡πà‡∏ô
- ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

```typescript
import { getAIResponse, shouldUseAI } from "@/lib/gemini/ai-helper"

if (shouldUseAI(messageText)) {
  const aiResponse = await getAIResponse(messageText)
  // ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡πà‡∏≤‡∏ô LINE
}
```

## üé® Rich Menu

### Rich Menu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‡∏à‡∏≠‡∏á     ‚îÇ ‡πÄ‡∏ä‡πà‡∏≤    ‚îÇ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ ‚îÇ
‚îÇ ‡πÇ‡∏î‡∏£‡∏ô    ‚îÇ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‚îÇ ‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‡∏î‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤  ‚îÇ ‡∏ñ‡∏≤‡∏° AI  ‚îÇ ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**Areas:**
1. ‡∏à‡∏≠‡∏á‡∏û‡πà‡∏ô‡∏¢‡∏≤‡πÇ‡∏î‡∏£‡∏ô ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î LIFF `/line/liff/booking`
2. ‡πÄ‡∏ä‡πà‡∏≤‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£ ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î LIFF `/line/liff/rental`
3. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á ‚Üí ‡πÄ‡∏õ‡∏¥‡∏î LIFF `/line/liff/my-bookings`
4. ‡∏î‡∏π‡∏£‡∏≤‡∏Ñ‡∏≤ ‚Üí ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏£‡∏≤‡∏Ñ‡∏≤"
5. ‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‚Üí ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"
6. ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà ‚Üí ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠"

### Rich Menu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Provider (‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ ‡∏Ñ‡∏≥‡∏Ç‡∏≠    ‚îÇ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£  ‚îÇ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞   ‚îÇ
‚îÇ ‡πÄ‡∏ä‡πà‡∏≤     ‚îÇ ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á ‚îÇ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡πà‡∏≤ ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô  ‚îÇ ‡πÅ‡∏à‡πâ‡∏á    ‚îÇ ‡∏ä‡πà‡∏ß‡∏¢    ‚îÇ
‚îÇ ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ  ‚îÇ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤   ‚îÇ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üì° API Endpoints

### 1. Webhook (‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏Å LINE)
```
POST /api/line/webhook
```

**Flow:**
1. ‡∏£‡∏±‡∏ö event ‡∏à‡∏≤‡∏Å LINE
2. Verify signature
3. ‡πÅ‡∏¢‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á
4. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Supabase
5. ‡πÉ‡∏ä‡πâ AI ‡∏ï‡∏≠‡∏ö (‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ)
6. ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö

### 2. Rich Menu Management
```
POST /api/line/richmenu
GET /api/line/richmenu
DELETE /api/line/richmenu?richMenuId={id}
```

**Actions:**
- `create` - ‡∏™‡∏£‡πâ‡∏≤‡∏á Rich Menu
- `setDefault` - ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
- `linkToUser` - ‡∏ú‡∏π‡∏Å‡∏Å‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏â‡∏û‡∏≤‡∏∞

## üîß ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤

### Environment Variables
```env
LINE_CHANNEL_ACCESS_TOKEN=your_channel_access_token
LINE_CHANNEL_SECRET=your_channel_secret
NEXT_PUBLIC_BASE_URL=https://your-domain.com
```

### Gemini AI Setup
```typescript
// lib/gemini/ai-helper.ts
const GEMINI_API_KEY = "AIzaSyDcMzY_EyWAOMK1o7DGek37b8DjKKAdpDM"
```

## üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•

### 1. ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£
```sql
-- ‡∏ä‡∏ô‡∏¥‡∏î‡∏û‡∏∑‡∏ä
SELECT name, price_per_rai
FROM crop_types
WHERE is_active = true

-- ‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡∏≤‡∏£‡∏û‡πà‡∏ô
SELECT name, price_per_rai
FROM spray_types
WHERE is_active = true
```

### 2. ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡πÉ‡∏´‡πâ‡πÄ‡∏ä‡πà‡∏≤
```sql
SELECT name, model, rental_price_per_day
FROM equipment
WHERE is_active = true AND status = 'available'
```

### 3. ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
```sql
SELECT booking_code, status, total_price
FROM bookings
WHERE line_user_id = {userId}
ORDER BY created_at DESC
LIMIT 1
```

## üéØ Message Templates

### 1. ‡∏à‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏î‡∏£‡∏ô
```json
{
  "type": "flex",
  "altText": "‡∏à‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡πà‡∏ô‡∏¢‡∏≤‡πÇ‡∏î‡∏£‡∏ô",
  "contents": {
    "type": "bubble",
    "hero": { ... },
    "body": {
      "contents": [
        "üöÅ ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏û‡πà‡∏ô‡∏¢‡∏≤‡πÇ‡∏î‡∏£‡∏ô",
        "‚úÖ ‡πÇ‡∏î‡∏£‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ 6 ‡∏•‡∏≥",
        "‚úÖ ‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û‡∏°‡∏µ‡πÉ‡∏ö‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï",
        "üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô 300 ‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà"
      ]
    },
    "footer": {
      "button": "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≠‡∏á‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£"
    }
  }
}
```

### 2. ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (Dynamic)
```typescript
// ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å DB
const { data: cropTypes } = await supabase
  .from("crop_types")
  .select("name, price_per_rai")

// ‡∏™‡∏£‡πâ‡∏≤‡∏á Flex Message ‡πÅ‡∏ö‡∏ö dynamic
const cropContents = cropTypes.map(crop => ({
  type: "box",
  contents: [
    { text: `‚Ä¢ ${crop.name}` },
    { text: `${crop.price_per_rai} ‡∏ö‡∏≤‡∏ó/‡πÑ‡∏£‡πà` }
  ]
}))
```

### 3. AI Response
```typescript
const aiResponse = await getAIResponse(userMessage)

await sendLineMessage(userId, {
  type: "text",
  text: `ü§ñ AI Assistant:\n\n${aiResponse}\n\n---\n‡∏û‡∏¥‡∏°‡∏û‡πå "‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î`
})
```

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö

### 1. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Webhook
```bash
# ‡∏™‡πà‡∏á test message ‡∏ú‡πà‡∏≤‡∏ô LINE Developer Console
# ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ ngrok tunnel
ngrok http 3000
```

### 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö AI
```typescript
// lib/gemini/ai-helper.ts
const response = await getAIResponse("‡πÇ‡∏î‡∏£‡∏ô‡∏û‡πà‡∏ô‡∏¢‡∏≤‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ñ‡∏ß‡∏£‡πÉ‡∏ä‡πâ‡∏™‡∏≤‡∏£‡∏≠‡∏∞‡πÑ‡∏£")
console.log(response)
```

### 3. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Rich Menu
```bash
curl -X POST http://localhost:3000/api/line/richmenu \
  -H "Content-Type: application/json" \
  -d '{
    "action": "create",
    "menuType": "farmer"
  }'
```

## üîê Security

### Signature Verification
```typescript
function verifySignature(body: string, signature: string | null): boolean {
  const hash = crypto
    .createHmac("sha256", channelSecret)
    .update(body, "utf8")
    .digest("base64")

  return hash === signature
}
```

### Input Sanitization
- ‡πÉ‡∏ä‡πâ `sanitizeInput()` ‡∏à‡∏≤‡∏Å `lib/security.ts`
- Validate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏Ç‡πâ‡∏≤ DB

## üìà Analytics & Monitoring

### Logging
```typescript
console.log("Message from user:", userId, "text:", messageText)
console.log("AI Response:", aiResponse)
console.log("Message sent successfully")
```

### Metrics ‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°
- ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö
- ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏ö‡πà‡∏≠‡∏¢
- AI usage rate
- Response time

## üöÄ Deployment

### 1. Deploy to Vercel/Production
```bash
# ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Environment Variables
vercel env add LINE_CHANNEL_ACCESS_TOKEN
vercel env add LINE_CHANNEL_SECRET

# Deploy
vercel --prod
```

### 2. ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó LINE Webhook URL
```
https://your-domain.com/api/line/webhook
```

### 3. Setup Rich Menu
```bash
# ‡∏™‡∏£‡πâ‡∏≤‡∏á Rich Menu ‡∏ú‡πà‡∏≤‡∏ô API
curl -X POST https://your-domain.com/api/line/richmenu \
  -d '{"action":"create","menuType":"farmer"}'

# ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô
curl -X POST https://your-domain.com/api/line/richmenu \
  -d '{"action":"setDefault","richMenuId":"richmenu-xxx"}'
```

## üìù Notes

1. **LIFF URL** - ‡πÉ‡∏ä‡πâ production URL ‡πÄ‡∏°‡∏∑‡πà‡∏≠ deploy
2. **Rich Menu Images** - ‡∏Ñ‡∏ß‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏Ç‡∏ô‡∏≤‡∏î 2500x1686 px
3. **AI Limits** - Gemini API ‡∏°‡∏µ rate limit ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏° caching
4. **Error Handling** - ‡∏ó‡∏∏‡∏Å function ‡∏°‡∏µ try-catch

## üÜò Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Webhook ‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö signature verification
- ‡∏î‡∏π console logs
- ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ú‡πà‡∏≤‡∏ô ngrok

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: AI ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Gemini API key
- ‡∏î‡∏π error logs
- ‡∏•‡∏≠‡∏á test ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤: Rich Menu ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö LINE_CHANNEL_ACCESS_TOKEN
- ‡∏î‡∏π Rich Menu list ‡∏ú‡πà‡∏≤‡∏ô API
- ‡∏•‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà

## üéâ Summary

‚úÖ LINE Messaging ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
‚úÖ Gemini AI ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
‚úÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á
‚úÖ Rich Menu ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö 2 ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ
‚úÖ API ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£

**‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏° Deploy ‡πÅ‡∏•‡πâ‡∏ß!** üöÄ
